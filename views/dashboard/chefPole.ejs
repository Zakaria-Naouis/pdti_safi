<% if (successMessage) { %>
<div class="alert alert-success alert-dismissible fade show" role="alert">
  <%= successMessage %>
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<% } %>

<div class="row">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>Statistiques de votre Pôle</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <h5 class="card-title">Total Projets</h5>
                <h3><%= stats.total_projets %></h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <h5 class="card-title">Coût Total (MDH)</h5>
                <h3><%= stats.cout_total.toFixed(2) %></h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-info text-white">
              <div class="card-body">
                <h5 class="card-title">Emplois Directs</h5>
                <h3><%= stats.total_emplois %></h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-warning text-white">
              <div class="card-body">
                <h5 class="card-title">Bénéficiaires</h5>
                <h3><%= stats.total_beneficiaires %></h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Projets de votre Pôle</h5>
        <span class="badge bg-primary rounded-pill"><%= pagination.totalItems %> projets</span>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Numéro</th>
                <th>Intitulé</th>
                <th>Axe</th>
                <th>Secteur</th>
                <th>Coût (MDH)</th>
                <th>Emplois</th>
                <th>Bénéficiaires</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% projects.forEach(function(project) { %>
              <tr>
                <td><%= project.num_projet %></td>
                <td>
                  <a href="/projects/edit/<%= project.id %>" class="text-decoration-none">
                    <%= project.intitule %>
                  </a>
                </td>
                <td><%= project.lib_axe %></td>
                <td><%= project.lib_secteur %></td>
                <td><%= project.cout_total_mdh %></td>
                <td><%= project.nbr_emplois_directs %></td>
                <td><%= project.nbr_beneficiaires %></td>
                <td>
                  <a href="/projects/edit/<%= project.id %>" class="btn btn-sm btn-primary">
                    <i class="fas fa-edit"></i> Modifier
                  </a>
                </td>
              </tr>
              <% }); %>

              <% if (projects.length === 0) { %>
              <tr>
                <td colspan="8" class="text-center">Aucun projet trouvé</td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <% if (pagination.totalPages > 1) { %>
        <nav aria-label="Pagination des projets">
          <ul class="pagination justify-content-center">
            <li class="page-item <%= !pagination.hasPrev ? 'disabled' : '' %>">
              <a class="page-link" href="?page=1" tabindex="-1" aria-disabled="<%= !pagination.hasPrev %>">
                <i class="fas fa-angle-double-left"></i>
              </a>
            </li>
            <li class="page-item <%= !pagination.hasPrev ? 'disabled' : '' %>">
              <a class="page-link" href="?page=<%= pagination.currentPage - 1 %>" tabindex="-1" aria-disabled="<%= !pagination.hasPrev %>">
                <i class="fas fa-angle-left"></i> Précédent
              </a>
            </li>

            <% for (let i = 1; i <= pagination.totalPages; i++) { %>
            <li class="page-item <%= i === pagination.currentPage ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>"><%= i %></a>
            </li>
            <% } %>

            <li class="page-item <%= !pagination.hasNext ? 'disabled' : '' %>">
              <a class="page-link" href="?page=<%= pagination.currentPage + 1 %>" aria-disabled="<%= !pagination.hasNext %>">
                Suivant <i class="fas fa-angle-right"></i>
              </a>
            </li>
            <li class="page-item <%= !pagination.hasNext ? 'disabled' : '' %>">
              <a class="page-link" href="?page=<%= pagination.totalPages %>" aria-disabled="<%= !pagination.hasNext %>">
                <i class="fas fa-angle-double-right"></i>
              </a>
            </li>
          </ul>
        </nav>
        <% } %>
      </div>
    </div>
  </div>
</div>